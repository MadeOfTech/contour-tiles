version: '3'
services:
  tilesbuilder:
    build: .
    links:
      - postgres-osm:pg
    volumes:
      - ~/osm:/data
      - ./docs:/docs
    depends_on:
      - postgres-osm

  tileserver:
    image: "klokantech/tileserver-gl"
    volumes:
      - ~/osm:/data
      - ./conf:/conf
      - ./styles:/styles
    command: -c /conf/config.json
    ports:
      - "8080:80"
    depends_on:
      - "tilesbuilder"

  docs:
    image: "nginx"
    volumes:
      - ./docs/build/html:/usr/share/nginx/html
    ports:
      - 9090:80
    depends_on:
      - "tilesbuilder"

  postgres-osm:
    image: "openfirmware/postgres-osm"
    ports:
      - 25432:5432

  maputnik:
    image: "maputnik/editor"
    volumes:
      - ./styles:/styles
    #command: maputnik --watch --file /styles/basic.json
    ports:
      - 8888:8888